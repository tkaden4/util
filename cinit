#!/bin/bash

if [[ $# -ne 1 ]]; then
    echo "usage: cinit <project-name>"
    exit 1
fi

echo "Creating C project \"$1\""

project=$1

if [[ -d $project ]]; then
    echo "Project already exists"
    exit 1
fi

mkdir $project
cd $project

# create directories
mkdir src
mkdir include
mkdir tests

# create the project makefile
cat > makefile << _EOF_
# Generated by "cinit $project"
SOURCES=\$(wildcard src/*.c)
OBJECTS=\$(SOURCES:.c=.o)
CFLAGS=-Wall -Wextra -Werror -Wno-unused-function -std=gnu99 -I./include/
EXECUTABLE=$project

HAS_CCACHE := \$(shell command -v ccache 2> /dev/null)
ifdef HAS_CCACHE
    CC:=ccache \$(CC)
endif

all: \$(EXECUTABLE)

\$(EXECUTABLE) : \$(OBJECTS)
	\$(CC) -o \$@ $^ \$(LIBS) \$(CFLAGS)

run:
	./\$(EXECUTABLE)

clean:
	\$(RM) \$(EXECUTABLE)
	\$(RM) \$(OBJECTS)

.PHONY: run clean
_EOF_

# create default main file
cat > src/main.c << _EOF_
/* Author: Kaden Thomas */
#include<stdio.h>
#include<stdlib.h>

int main()
{
    return EXIT_SUCCESS;
}
_EOF_
